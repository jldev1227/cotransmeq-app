<script lang="ts">
	import { onMount } from 'svelte';
	import { fade, fly } from 'svelte/transition';
	import { toast } from 'svelte-sonner';
	import {
		accionesCorrectivasAPI,
		type AccionCorrectivaPreventiva,
		type ListarAccionesFiltros,
		type TipoAccion,
		type EstadoAccion,
		type ValoracionRiesgo,
		type EstadisticasAcciones
	} from '$lib/api/acciones-correctivas';
	import ModalFormularioAccion from '$lib/components/acciones-correctivas/ModalFormularioAccion.svelte';

	// Estado
	let acciones: AccionCorrectivaPreventiva[] = [];
	let estadisticas: EstadisticasAcciones | null = null;
	let isLoading = true;
	let isLoadingStats = true;

	// Paginación
	let page = 1;
	let limit = 10;
	let total = 0;
	let totalPages = 0;

	// Filtros
	let filtros: ListarAccionesFiltros = {
		page,
		limit
	};
	let busqueda = '';
	let tipoFiltro: TipoAccion | '' = '';
	let estadoFiltro: EstadoAccion | '' = '';
	let riesgoFiltro: ValoracionRiesgo | '' = '';
	let fechaDesde = '';
	let fechaHasta = '';

	// Modal
	let showModal = false;
	let accionEditar: AccionCorrectivaPreventiva | null = null;
	let modoEdicion = false;

	onMount(async () => {
		await Promise.all([cargarAcciones(), cargarEstadisticas()]);
	});

	async function cargarAcciones() {
		isLoading = true;
		try {
			filtros = {
				page,
				limit,
				...(busqueda && { busqueda }),
				...(tipoFiltro && { tipo: tipoFiltro }),
				...(estadoFiltro && { estado: estadoFiltro }),
				...(riesgoFiltro && { riesgo: riesgoFiltro }),
				...(fechaDesde && { fecha_desde: fechaDesde }),
				...(fechaHasta && { fecha_hasta: fechaHasta })
			};

			const resultado = await accionesCorrectivasAPI.listar(filtros);
			acciones = resultado.acciones;
			total = resultado.total;
			totalPages = resultado.totalPages;
		} catch (error: any) {
			toast.error(error.message || 'Error al cargar las acciones');
			acciones = [];
		} finally {
			isLoading = false;
		}
	}

	async function cargarEstadisticas() {
		isLoadingStats = true;
		try {
			estadisticas = await accionesCorrectivasAPI.obtenerEstadisticas();
		} catch (error: any) {
			console.error('Error al cargar estadísticas:', error);
		} finally {
			isLoadingStats = false;
		}
	}

	function aplicarFiltros() {
		page = 1;
		cargarAcciones();
	}

	function limpiarFiltros() {
		busqueda = '';
		tipoFiltro = '';
		estadoFiltro = '';
		riesgoFiltro = '';
		fechaDesde = '';
		fechaHasta = '';
		page = 1;
		cargarAcciones();
	}

	function cambiarPagina(nuevaPagina: number) {
		page = nuevaPagina;
		cargarAcciones();
	}

	function abrirModalCrear() {
		accionEditar = null;
		modoEdicion = false;
		showModal = true;
	}

	function abrirModalEditar(accion: AccionCorrectivaPreventiva) {
		accionEditar = accion;
		modoEdicion = true;
		showModal = true;
	}

	function cerrarModal() {
		showModal = false;
		accionEditar = null;
		modoEdicion = false;
	}

	async function handleGuardado() {
		cerrarModal();
		await Promise.all([cargarAcciones(), cargarEstadisticas()]);
		toast.success(modoEdicion ? 'Acción actualizada correctamente' : 'Acción creada correctamente');
	}

	async function eliminarAccion(id: string, accion_numero: string) {
		if (!confirm(`¿Está seguro de eliminar la acción ${accion_numero}?`)) {
			return;
		}

		try {
			await accionesCorrectivasAPI.eliminar(id);
			toast.success('Acción eliminada correctamente');
			await Promise.all([cargarAcciones(), cargarEstadisticas()]);
		} catch (error: any) {
			toast.error(error.message || 'Error al eliminar la acción');
		}
	}

	async function descargarPDF(id: string, accion_numero: string) {
		try {
			toast.loading('Generando PDF...');
			await accionesCorrectivasAPI.descargarPDF(id, accion_numero);
			toast.success('PDF descargado correctamente');
		} catch (error: any) {
			toast.error(error.message || 'Error al descargar el PDF');
		}
	}

	function formatearFecha(fecha: string | undefined): string {
		if (!fecha) return 'N/A';
		const date = new Date(fecha);
		return date.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
	}

	function getBadgeColorTipo(tipo: TipoAccion | undefined): string {
		switch (tipo) {
			case 'CORRECTIVA':
				return 'bg-red-100 text-red-700 border border-red-200';
			case 'PREVENTIVA':
				return 'bg-blue-100 text-blue-700 border border-blue-200';
			case 'MEJORA':
				return 'bg-orange-100 text-orange-700 border border-orange-200';
			default:
				return 'bg-gray-100 text-gray-700 border border-gray-200';
		}
	}

	function getBadgeColorEstado(estado: EstadoAccion | undefined): string {
		switch (estado) {
			case 'Cumplidas':
				return 'bg-orange-100 text-orange-700 border border-orange-200';
			case 'En Proceso':
				return 'bg-yellow-100 text-yellow-700 border border-yellow-200';
			case 'Vencidas':
				return 'bg-red-100 text-red-700 border border-red-200';
			default:
				return 'bg-gray-100 text-gray-700 border border-gray-200';
		}
	}

	function getBadgeColorRiesgo(riesgo: ValoracionRiesgo | undefined): string {
		switch (riesgo) {
			case 'ALTO':
				return 'bg-red-100 text-red-700 border border-red-200';
			case 'MEDIO':
				return 'bg-yellow-100 text-yellow-700 border border-yellow-200';
			case 'BAJO':
				return 'bg-orange-100 text-orange-700 border border-orange-200';
			default:
				return 'bg-gray-100 text-gray-700 border border-gray-200';
		}
	}
</script>

<!-- Header -->
<div class="mb-6" in:fade={{ duration: 400 }}>
	<h1 class="text-2xl font-bold text-gray-900 mb-2">
		Acciones Correctivas y Preventivas
	</h1>
	<p class="text-gray-600">Matriz HSEQ-MTR-07 - Gestión de hallazgos y planes de acción</p>
</div>

<!-- Estadísticas -->
{#if !isLoadingStats && estadisticas}
	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" transition:fade>
		<!-- Total -->
		<div class="glass rounded-xl p-5 border border-gray-200" in:fly={{ y: 20, delay: 100 }}>
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm text-gray-600 mb-1">Total Acciones</p>
					<p class="text-3xl font-bold text-gray-900">{estadisticas.total}</p>
				</div>
				<div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-orange-400 to-orange-600 shadow-lg shadow-orange-500/30">
					<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
					</svg>
				</div>
			</div>
		</div>

		<!-- En Proceso -->
		<div class="glass rounded-xl p-5 border border-gray-200" in:fly={{ y: 20, delay: 200 }}>
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm text-gray-600 mb-1">En Proceso</p>
					<p class="text-3xl font-bold text-yellow-600">{estadisticas.por_estado['En Proceso']}</p>
				</div>
				<div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-yellow-400 to-yellow-600 shadow-lg shadow-yellow-500/30">
					<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
				</div>
			</div>
		</div>

		<!-- Próximas a Vencer -->
		<div class="glass rounded-xl p-5 border border-gray-200" in:fly={{ y: 20, delay: 300 }}>
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm text-gray-600 mb-1">Próximas a Vencer</p>
					<p class="text-3xl font-bold text-orange-600">{estadisticas.proximas_vencer}</p>
				</div>
				<div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-orange-400 to-orange-600 shadow-lg shadow-orange-500/30">
					<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
					</svg>
				</div>
			</div>
		</div>

		<!-- Cumplidas -->
		<div class="glass rounded-xl p-5 border border-gray-200" in:fly={{ y: 20, delay: 400 }}>
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm text-gray-600 mb-1">Cumplidas</p>
					<p class="text-3xl font-bold text-orange-600">{estadisticas.por_estado.Cumplidas}</p>
				</div>
				<div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-orange-400 to-orange-600 shadow-lg shadow-orange-500/30">
					<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
				</div>
			</div>
		</div>
	</div>
{/if}

<!-- Filtros y Controles -->
<div class="glass rounded-xl p-6 mb-6 border border-gray-200" in:fly={{ y: 20, delay: 500 }}>
	<div class="flex flex-col lg:flex-row gap-4 mb-4">
		<!-- Búsqueda -->
		<div class="flex-1">
			<input
				type="text"
				bind:value={busqueda}
				placeholder="Buscar por número, descripción, lugar o responsable..."
				class="w-full px-4 py-2.5 bg-white/80 border border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-orange-400/20 focus:border-orange-400 apple-transition"
				on:keypress={(e) => e.key === 'Enter' && aplicarFiltros()}
			/>
		</div>

		<!-- Botón Nueva Acción -->
		<button
			on:click={abrirModalCrear}
			class="px-6 py-2.5 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 apple-transition flex items-center gap-2 whitespace-nowrap shadow-lg shadow-orange-500/30"
		>
			<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
			</svg>
			Nueva Acción
		</button>
	</div>

	<!-- Filtros avanzados -->
	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4">
		<select
			bind:value={tipoFiltro}
			class="px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white apple-transition focus:ring-2 focus:ring-orange-500/50"
		>
			<option value="">Todos los tipos</option>
			<option value="CORRECTIVA">Correctiva</option>
			<option value="PREVENTIVA">Preventiva</option>
			<option value="MEJORA">Mejora</option>
		</select>

		<select
			bind:value={estadoFiltro}
			class="px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white apple-transition focus:ring-2 focus:ring-orange-500/50"
		>
			<option value="">Todos los estados</option>
			<option value="Cumplidas">Cumplidas</option>
			<option value="En Proceso">En Proceso</option>
			<option value="Vencidas">Vencidas</option>
		</select>

		<select
			bind:value={riesgoFiltro}
			class="px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white apple-transition focus:ring-2 focus:ring-orange-500/50"
		>
			<option value="">Todos los riesgos</option>
			<option value="ALTO">Alto</option>
			<option value="MEDIO">Medio</option>
			<option value="BAJO">Bajo</option>
		</select>

		<input
			type="date"
			bind:value={fechaDesde}
			placeholder="Desde"
			class="px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white apple-transition focus:ring-2 focus:ring-orange-500/50"
		/>

		<input
			type="date"
			bind:value={fechaHasta}
			placeholder="Hasta"
			class="px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white apple-transition focus:ring-2 focus:ring-orange-500/50"
		/>
	</div>

	<!-- Botones de acción -->
	<div class="flex gap-2">
		<button
			on:click={aplicarFiltros}
			class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 apple-transition"
		>
			Aplicar Filtros
		</button>
		<button
			on:click={limpiarFiltros}
			class="px-4 py-2 bg-white/5 text-orange-200 rounded-lg hover:bg-white/10 apple-transition"
		>
			Limpiar
		</button>
	</div>
</div>

<!-- Tabla de Acciones -->
{#if isLoading}
	<div class="glass-card border border-white/10 rounded-xl p-8 flex justify-center items-center">
		<div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"></div>
	</div>
{:else if acciones.length === 0}
	<div class="glass-card border border-white/10 rounded-xl p-8 text-center">
		<svg class="mx-auto h-12 w-12 text-orange-400/50 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
		</svg>
		<h3 class="text-lg font-medium text-white mb-2">No hay acciones registradas</h3>
		<p class="text-orange-200/70 mb-4">Comienza creando una nueva acción correctiva o preventiva.</p>
		<button
			on:click={abrirModalCrear}
			class="px-6 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 apple-transition soft-shadow"
		>
			Crear Primera Acción
		</button>
	</div>
{:else}
	<div class="glass-card border border-white/10 rounded-xl overflow-hidden" transition:fade>
		<div class="overflow-x-auto">
			<table class="min-w-full divide-y divide-white/10">
				<thead class="bg-white/5">
					<tr>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Número
						</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Descripción
						</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Tipo
						</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Estado
						</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Riesgo
						</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Responsable
						</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Fecha Límite
						</th>
						<th class="px-6 py-3 text-right text-xs font-medium text-orange-200/70 uppercase tracking-wider">
							Acciones
						</th>
					</tr>
				</thead>
				<tbody class="divide-y divide-white/5">
					{#each acciones as accion (accion.id)}
						<tr class="hover:bg-white/5 apple-transition" transition:fly={{ y: 20, duration: 300 }}>
							<td class="px-6 py-4 whitespace-nowrap">
								<span class="text-sm font-medium text-white">{accion.accion_numero}</span>
							</td>
							<td class="px-6 py-4">
								<div class="text-sm text-white max-w-xs truncate">
									{accion.descripcion_hallazgo || 'Sin descripción'}
								</div>
								<div class="text-xs text-orange-200/50">{accion.lugar_sede || 'Sin lugar'}</div>
							</td>
							<td class="px-6 py-4 whitespace-nowrap">
								<span class="px-2 py-1 text-xs font-semibold rounded-full border {getBadgeColorTipo(accion.tipo_accion_ejecutar)}">
									{accion.tipo_accion_ejecutar || 'N/A'}
								</span>
							</td>
							<td class="px-6 py-4 whitespace-nowrap">
								<span class="px-2 py-1 text-xs font-semibold rounded-full border {getBadgeColorEstado(accion.estado_accion_planeada)}">
									{accion.estado_accion_planeada || 'N/A'}
								</span>
							</td>
							<td class="px-6 py-4 whitespace-nowrap">
								<span class="px-2 py-1 text-xs font-semibold rounded-full border {getBadgeColorRiesgo(accion.valoracion_riesgo)}">
									{accion.valoracion_riesgo || 'N/A'}
								</span>
							</td>
							<td class="px-6 py-4 whitespace-nowrap">
								<div class="text-sm text-white">{accion.responsable_ejecucion || 'No asignado'}</div>
							</td>
							<td class="px-6 py-4 whitespace-nowrap">
								<div class="text-sm text-white">{formatearFecha(accion.fecha_limite_implementacion)}</div>
							</td>
							<td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
								<div class="flex items-center justify-end gap-2">
									<button
										on:click={() => descargarPDF(accion.id, accion.accion_numero)}
										class="text-orange-400 hover:text-orange-300 apple-transition"
										title="Descargar PDF"
									>
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
										</svg>
									</button>
									<button
										on:click={() => abrirModalEditar(accion)}
										class="text-blue-400 hover:text-blue-300 apple-transition"
										title="Editar"
									>
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
										</svg>
									</button>
									<button
										on:click={() => eliminarAccion(accion.id, accion.accion_numero)}
										class="text-red-400 hover:text-red-300 apple-transition"
										title="Eliminar"
									>
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
										</svg>
									</button>
								</div>
							</td>
						</tr>
					{/each}
				</tbody>
			</table>
		</div>

		<!-- Paginación -->
		{#if totalPages > 1}
			<div class="bg-white/5 px-4 py-3 flex items-center justify-between border-t border-white/10 sm:px-6">
				<div class="flex-1 flex justify-between sm:hidden">
					<button
						on:click={() => cambiarPagina(page - 1)}
						disabled={page === 1}
						class="relative inline-flex items-center px-4 py-2 border border-white/10 text-sm font-medium rounded-md text-orange-200 bg-white/5 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed apple-transition"
					>
						Anterior
					</button>
					<button
						on:click={() => cambiarPagina(page + 1)}
						disabled={page === totalPages}
						class="ml-3 relative inline-flex items-center px-4 py-2 border border-white/10 text-sm font-medium rounded-md text-orange-200 bg-white/5 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed apple-transition"
					>
						Siguiente
					</button>
				</div>
				<div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
					<div>
						<p class="text-sm text-orange-200/70">
							Mostrando <span class="font-medium text-white">{(page - 1) * limit + 1}</span> a
							<span class="font-medium text-white">{Math.min(page * limit, total)}</span> de
							<span class="font-medium text-white">{total}</span> resultados
						</p>
					</div>
					<div>
						<nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
							<button
								on:click={() => cambiarPagina(page - 1)}
								disabled={page === 1}
								class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-white/10 bg-white/5 text-sm font-medium text-orange-200 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed apple-transition"
							>
								<span class="sr-only">Anterior</span>
								<svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
								</svg>
							</button>
							{#each Array(totalPages) as _, i}
								{#if i + 1 === 1 || i + 1 === totalPages || (i + 1 >= page - 1 && i + 1 <= page + 1)}
									<button
										on:click={() => cambiarPagina(i + 1)}
										class="relative inline-flex items-center px-4 py-2 border border-white/10 text-sm font-medium apple-transition {page === i + 1 ? 'bg-orange-500/20 text-orange-300 z-10' : 'bg-white/5 text-orange-200 hover:bg-white/10'}"
									>
										{i + 1}
									</button>
								{:else if i + 1 === page - 2 || i + 1 === page + 2}
									<span class="relative inline-flex items-center px-4 py-2 border border-white/10 bg-white/5 text-sm font-medium text-orange-200">
										...
									</span>
								{/if}
							{/each}
							<button
								on:click={() => cambiarPagina(page + 1)}
								disabled={page === totalPages}
								class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-white/10 bg-white/5 text-sm font-medium text-orange-200 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed apple-transition"
							>
								<span class="sr-only">Siguiente</span>
								<svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
								</svg>
							</button>
						</nav>
					</div>
				</div>
			</div>
		{/if}
	</div>
{/if}

<!-- Modal -->
{#if showModal}
	<ModalFormularioAccion
		accion={accionEditar}
		{modoEdicion}
		on:close={cerrarModal}
		on:guardado={handleGuardado}
	/>
{/if}
